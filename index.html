<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="https://bootswatch.com/4/darkly/bootstrap.min.css">
  <meta charset="UTF-8">
  <title>File Upload</title>
</head>

<body>



<div class="container" style="margin: auto;padding:20px 0;align-items: center;justify-content: space-around;">
  <h5>Files</h5>
  <div class="bs-docs-section">
    <form id="uploadForm" enctype="multipart/form-data" method="POST">
      <fieldset>
        <div class="form-group">
          <label for="inputfile">File Upload</label>
          <input type="file" name="test_file" class="form-control-file" id="inputfile" aria-describedby="fileHelp">
          <button type="button" onClick="uploadFile()" class="btn btn-primary btn-sm">Upload</button>
        </div>
      </fieldset>
    </form>
    <ul id='ul-container' class="list-group">

    </ul>
  </div>
</div>



</body>

<script type="text/javascript">
  fetch('files').then(response => response.json())
  .then((data)=>  {
    const ul = document.getElementById('ul-container');
    data.forEach(element => {
      ul.innerHTML += `<li class="list-group-item d-flex justify-content-between align-items-center">
        <a href="/files/${element.publicKey}">${element.originalName}</a><button onClick="deleteFile('${element.id}')" type="button" class="btn btn-danger btn-sm">Delete</button>
        </li>`;
    });      
  })
  .catch(e => {console.log(e)})

  function uploadFile() {
    debugger
    const form = document.getElementById('uploadForm');
    const formData = new FormData(form);
    fetch('files',{
      method: 'post',
      body: formData
    }).then(response => response.json())
    .then((data)=>{
      console.log(data);
      alert(data.message);
      window.location = '/';
    })
  }

  function deleteFile(privateKey) {

    const del = confirm('Are you sure?');
    if(del) {
      fetch('files/' + privateKey, {method: 'delete'}).then(response => response.json())
      .then((data)=>{
        alert(data.message);
        window.location = '/';
      })
    .catch(e => console.log(e));
    }

    
  }
</script>

</html>